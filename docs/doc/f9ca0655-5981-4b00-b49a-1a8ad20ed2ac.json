{
    "summary": "This code introduces PaddleVideo's model compression using PaddleSlim, demonstrates PP-TSM quantized model prediction and pruning methods, providing recommendations for hyperparameters when using quantized training with pre-trained models.",
    "details": [
        {
            "comment": "This code provides an introduction to the slim functionality of PaddleVideo's model compression using PaddleSlim. It explains the purpose and benefits of model quantization and pruning, and how to use PaddleSlim for PaddleVideo model compression.",
            "location": "\"/media/root/Prima/works/PaddleVideo/docs/src/deploy/slim/readme.md\":1-43",
            "content": "## Slim\u529f\u80fd\u4ecb\u7ecd\n\u590d\u6742\u7684\u6a21\u578b\u6709\u5229\u4e8e\u63d0\u9ad8\u6a21\u578b\u7684\u6027\u80fd\uff0c\u4f46\u4e5f\u5bfc\u81f4\u6a21\u578b\u4e2d\u5b58\u5728\u4e00\u5b9a\u5197\u4f59\u3002\u6b64\u90e8\u5206\u63d0\u4f9b\u7cbe\u7b80\u6a21\u578b\u7684\u529f\u80fd\uff0c\u5305\u62ec\u4e24\u90e8\u5206\uff1a\u6a21\u578b\u91cf\u5316\uff08\u91cf\u5316\u8bad\u7ec3\u3001\u79bb\u7ebf\u91cf\u5316\uff09\u3001\u6a21\u578b\u526a\u679d\u3002\n\u5176\u4e2d\u6a21\u578b\u91cf\u5316\u5c06\u5168\u7cbe\u5ea6\u7f29\u51cf\u5230\u5b9a\u70b9\u6570\u51cf\u5c11\u8fd9\u79cd\u5197\u4f59\uff0c\u8fbe\u5230\u51cf\u5c11\u6a21\u578b\u8ba1\u7b97\u590d\u6742\u5ea6\uff0c\u63d0\u9ad8\u6a21\u578b\u63a8\u7406\u6027\u80fd\u7684\u76ee\u7684\u3002\n\u6a21\u578b\u91cf\u5316\u53ef\u4ee5\u5728\u57fa\u672c\u4e0d\u635f\u5931\u6a21\u578b\u7684\u7cbe\u5ea6\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06FP32\u7cbe\u5ea6\u7684\u6a21\u578b\u53c2\u6570\u8f6c\u6362\u4e3aInt8\u7cbe\u5ea6\uff0c\u51cf\u5c0f\u6a21\u578b\u53c2\u6570\u5927\u5c0f\u5e76\u52a0\u901f\u8ba1\u7b97\uff0c\u4f7f\u7528\u91cf\u5316\u540e\u7684\u6a21\u578b\u5728\u79fb\u52a8\u7aef\u7b49\u90e8\u7f72\u65f6\u66f4\u5177\u5907\u901f\u5ea6\u4f18\u52bf\u3002\n\u6a21\u578b\u526a\u679d\u5c06CNN\u4e2d\u4e0d\u91cd\u8981\u7684\u5377\u79ef\u6838\u88c1\u526a\u6389\uff0c\u51cf\u5c11\u6a21\u578b\u53c2\u6570\u91cf\uff0c\u4ece\u800c\u964d\u4f4e\u6a21\u578b\u8ba1\u7b97\u590d\u6742\u5ea6\u3002\n\u672c\u6559\u7a0b\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u98de\u6868\u6a21\u578b\u538b\u7f29\u5e93PaddleSlim\u505aPaddleVideo\u6a21\u578b\u7684\u538b\u7f29\u3002\n[PaddleSlim](https://github.com/PaddlePaddle/PaddleSlim) \u96c6\u6210\u4e86\u6a21\u578b\u526a\u679d\u3001\u91cf\u5316\uff08\u5305\u62ec\u91cf\u5316\u8bad\u7ec3\u548c\u79bb\u7ebf\u91cf\u5316\uff09\u3001\u84b8\u998f\u548c\u795e\u7ecf\u7f51\u7edc\u641c\u7d22\u7b49\u591a\u79cd\u4e1a\u754c\u5e38\u7528\u4e14\u9886\u5148\u7684\u6a21\u578b\u538b\u7f29\u529f\u80fd\uff0c\u5982\u679c\u60a8\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u5173\u6ce8\u5e76\u4e86\u89e3\u3002\n\u5728\u5f00\u59cb\u672c\u6559\u7a0b\u4e4b\u524d\uff0c\u5efa\u8bae\u5148\u4e86\u89e3[PaddleVideo\u6a21\u578b\u7684\u8bad\u7ec3\u65b9\u6cd5](../../docs/zh-CN/usage.md)\u4ee5\u53ca[PaddleSlim](https://paddleslim.readthedocs.io/zh_CN/latest/index.html)\n## \u5feb\u901f\u5f00\u59cb\n\u5f53\u8bad\u7ec3\u51fa\u4e00\u4e2a\u6a21\u578b\u540e\uff0c\u5982\u679c\u5e0c\u671b\u8fdb\u4e00\u6b65\u7684\u538b\u7f29\u6a21\u578b\u5927\u5c0f\u5e76\u52a0\u901f\u9884\u6d4b\uff0c\u53ef\u4f7f\u7528\u91cf\u5316\u6216\u8005\u526a\u679d\u7684\u65b9\u6cd5\u538b\u7f29\u6a21\u578b\u3002\n\u6a21\u578b\u538b\u7f29\u4e3b\u8981\u5305\u62ec\u4e94\u4e2a\u6b65\u9aa4\uff1a\n1. \u5b89\u88c5 PaddleSlim\n2. \u51c6\u5907\u8bad\u7ec3\u597d\u7684\u6a21\u578b\n3. \u6a21\u578b\u538b\u7f29\n4. \u5bfc\u51fa\u91cf\u5316\u63a8\u7406\u6a21\u578b\n5. \u91cf\u5316\u6a21\u578b\u9884\u6d4b\u90e8\u7f72\n### 1. \u5b89\u88c5PaddleSlim\n* \u53ef\u4ee5\u901a\u8fc7pip install\u7684\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5\u3002\n```bash\npython3.7 -m pip install paddleslim -i https://pypi.tuna.tsinghua.edu.cn/simple\n```\n* \u5982\u679c\u83b7\u53d6PaddleSlim\u7684\u6700\u65b0\u7279\u6027\uff0c\u53ef\u4ee5\u4ece\u6e90\u7801\u5b89\u88c5\u3002\n```bash\ngit clone https://github.com/PaddlePaddle/PaddleSlim.git\ncd Paddleslim\npython3.7 setup.py install\n```\n### 2. \u51c6\u5907\u8bad\u7ec3\u597d\u7684\u6a21\u578b\nPaddleVideo\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u8bad\u7ec3\u597d\u7684[\u6a21\u578b](../../docs/zh-CN/model_zoo/README.md)\uff0c\u5982\u679c\u5f85\u91cf\u5316\u7684\u6a21\u578b\u4e0d\u5728\u5217\u8868\u4e2d\uff0c\u9700\u8981\u6309\u7167[\u5e38\u89c4\u8bad\u7ec3](../../docs/zh-CN/usage.md)\u65b9\u6cd5\u5f97\u5230\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u3002"
        },
        {
            "comment": "This code snippet explains the process of offline quantization in PaddleVideo for model compression. It mentions that the code is located in `deploy/slim/quant_post_static.py`. The snippet also details the steps involved in offline quantization, including using a pre-trained model and specifying the quantization strategy in a configuration file. The process generates an output directory with `__model__` and `__params__` files that can be used for deployment without re-exporting the model.",
            "location": "\"/media/root/Prima/works/PaddleVideo/docs/src/deploy/slim/readme.md\":45-90",
            "content": "### 3. \u6a21\u578b\u538b\u7f29\n\u8fdb\u5165PaddleVideo\u6839\u76ee\u5f55\n```bash\ncd PaddleVideo\n```\n\u79bb\u7ebf\u91cf\u5316\u4ee3\u7801\u4f4d\u4e8e`deploy/slim/quant_post_static.py`\u3002\n#### 3.1 \u6a21\u578b\u91cf\u5316\n\u91cf\u5316\u8bad\u7ec3\u5305\u62ec\u79bb\u7ebf\u91cf\u5316\u8bad\u7ec3\u548c\u5728\u7ebf\u91cf\u5316\u8bad\u7ec3(TODO)\uff0c\u5728\u7ebf\u91cf\u5316\u8bad\u7ec3\u6548\u679c\u66f4\u597d\uff0c\u9700\u52a0\u8f7d\u9884\u8bad\u7ec3\u6a21\u578b\uff0c\u5728\u5b9a\u4e49\u597d\u91cf\u5316\u7b56\u7565\u540e\u5373\u53ef\u5bf9\u6a21\u578b\u8fdb\u884c\u91cf\u5316\u3002\n##### 3.1.1 \u5728\u7ebf\u91cf\u5316\u8bad\u7ec3\nTODO\n##### 3.1.2 \u79bb\u7ebf\u91cf\u5316\n**\u6ce8\u610f**\uff1a\u76ee\u524d\u79bb\u7ebf\u91cf\u5316\uff0c\u5fc5\u987b\u4f7f\u7528\u5df2\u7ecf\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u5bfc\u51fa\u7684`inference model`\u8fdb\u884c\u91cf\u5316\u3002\u4e00\u822c\u6a21\u578b\u5bfc\u51fa`inference model`\u53ef\u53c2\u8003[\u6559\u7a0b](../../docs/zh-CN/usage.md#5-\u6a21\u578b\u63a8\u7406).\n\u4e00\u822c\u6765\u8bf4\uff0c\u79bb\u7ebf\u91cf\u5316\u635f\u5931\u6a21\u578b\u7cbe\u5ea6\u8f83\u591a\u3002\n\u4ee5PP-TSM\u6a21\u578b\u4e3a\u4f8b\uff0c\u751f\u6210`inference model`\u540e\uff0c\u79bb\u7ebf\u91cf\u5316\u8fd0\u884c\u65b9\u5f0f\u5982\u4e0b\n```bash\n# \u4e0b\u8f7d\u5e76\u89e3\u538b\u51fa\u5c11\u91cf\u6570\u636e\u7528\u4e8e\u79bb\u7ebf\u91cf\u5316\u7684\u6821\u51c6\npushd ./data/k400\nwget -nc https://videotag.bj.bcebos.com/Data/k400_rawframes_small.tar\ntar -xf k400_rawframes_small.tar\npopd\n# \u7136\u540e\u8fdb\u5165deploy/slim\u76ee\u5f55\u4e0b\ncd deploy/slim\n# \u6267\u884c\u79bb\u7ebf\u91cf\u5316\u547d\u4ee4\npython3.7 quant_post_static.py \\\n-c ../../configs/recognition/pptsm/pptsm_k400_frames_uniform_quantization.yaml \\\n--use_gpu=True\n```\n\u9664`use_gpu`\u5916\uff0c\u6240\u6709\u7684\u91cf\u5316\u73af\u5883\u53c2\u6570\u90fd\u5728`pptsm_k400_frames_uniform_quantization.yaml`\u6587\u4ef6\u4e2d\u8fdb\u884c\u914d\u7f6e\n\u5176\u4e2d`inference_model_dir`\u8868\u793a\u4e0a\u4e00\u6b65\u5bfc\u51fa\u7684`inference model`\u76ee\u5f55\u8def\u5f84\uff0c`quant_output_dir`\u8868\u793a\u91cf\u5316\u6a21\u578b\u7684\u8f93\u51fa\u76ee\u5f55\u8def\u5f84\n\u6267\u884c\u6210\u529f\u540e\uff0c\u5728`quant_output_dir`\u7684\u76ee\u5f55\u4e0b\u751f\u6210\u4e86`__model__`\u6587\u4ef6\u548c`__params__`\u6587\u4ef6\uff0c\u8fd9\u4e8c\u8005\u7528\u4e8e\u5b58\u50a8\u751f\u6210\u7684\u79bb\u7ebf\u91cf\u5316\u6a21\u578b\n\u7c7b\u4f3c`inference model`\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u63a5\u4e0b\u6765\u53ef\u4ee5\u76f4\u63a5\u7528\u8fd9\u4e24\u4e2a\u6587\u4ef6\u8fdb\u884c\u9884\u6d4b\u90e8\u7f72\uff0c\u65e0\u9700\u518d\u91cd\u65b0\u5bfc\u51fa\u6a21\u578b\u3002"
        },
        {
            "comment": "This code snippet demonstrates the usage of PP-TSM quantized model for prediction in PaddleVideo. It directs the user to navigate into the PaddleVideo directory and then executes a python script with specific parameters such as input file, configuration file, model files, and flags for GPU and TensorRT utilization. The output shows the recognized top-1 class and score. The code also mentions additional information on how to prune models, export them, and deploy them in Python or C++ settings by referring to separate documentation sections. It provides recommendations for training hyperparameters when using quantized training with pre-trained models.",
            "location": "\"/media/root/Prima/works/PaddleVideo/docs/src/deploy/slim/readme.md\":92-132",
            "content": "```bash\n# \u4f7f\u7528PP-TSM\u79bb\u7ebf\u91cf\u5316\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\n# \u56de\u5230PaddleVideo\u76ee\u5f55\u4e0b\ncd ../../\n# \u4f7f\u7528\u91cf\u5316\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\npython3.7 tools/predict.py \\\n--input_file data/example.avi \\\n--config configs/recognition/pptsm/pptsm_k400_frames_uniform.yaml \\\n--model_file ./inference/ppTSM/quant_model/__model__ \\\n--params_file ./inference/ppTSM/quant_model/__params__ \\\n--use_gpu=True \\\n--use_tensorrt=False\n```\n\u8f93\u51fa\u5982\u4e0b\uff1a\n```bash\nCurrent video file: data/example.avi\n        top-1 class: 5\n        top-1 score: 0.9997928738594055\n```\n#### 3.2 \u6a21\u578b\u526a\u679d\nTODO\n### 4. \u5bfc\u51fa\u6a21\u578b\nTODO\n### 5. \u6a21\u578b\u90e8\u7f72\n\u4e0a\u8ff0\u6b65\u9aa4\u5bfc\u51fa\u7684\u6a21\u578b\u53ef\u4ee5\u901a\u8fc7PaddleLite\u7684opt\u6a21\u578b\u8f6c\u6362\u5de5\u5177\u5b8c\u6210\u6a21\u578b\u8f6c\u6362\u3002\n\u6a21\u578b\u90e8\u7f72\u7684\u53ef\u53c2\u8003\n[Serving Python\u90e8\u7f72](../python_serving/readme.md)\n[Serving C++\u90e8\u7f72](../cpp_serving/readme.md)\n## \u8bad\u7ec3\u8d85\u53c2\u6570\u5efa\u8bae\n* \u91cf\u5316\u8bad\u7ec3\u65f6\uff0c\u5efa\u8bae\u52a0\u8f7d\u5e38\u89c4\u8bad\u7ec3\u5f97\u5230\u7684\u9884\u8bad\u7ec3\u6a21\u578b\uff0c\u52a0\u901f\u91cf\u5316\u8bad\u7ec3\u6536\u655b\u3002\n* \u91cf\u5316\u8bad\u7ec3\u65f6\uff0c\u5efa\u8bae\u521d\u59cb\u5b66\u4e60\u7387\u4fee\u6539\u4e3a\u5e38\u89c4\u8bad\u7ec3\u7684`1/20~1/10`\uff0c\u540c\u65f6\u5c06\u8bad\u7ec3epoch\u6570\u4fee\u6539\u4e3a\u5e38\u89c4\u8bad\u7ec3\u7684`1/5~1/2`\uff0c\u5b66\u4e60\u7387\u7b56\u7565\u65b9\u9762\uff0c\u52a0\u4e0aWarmup\uff0c\u5176\u4ed6\u914d\u7f6e\u4fe1\u606f\u4e0d\u5efa\u8bae\u4fee\u6539\u3002"
        }
    ]
}