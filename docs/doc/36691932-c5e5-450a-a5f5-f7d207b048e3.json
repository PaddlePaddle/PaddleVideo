{
    "summary": "The script prepares PaddleVideo for TimeSformer benchmarking, downloads UCF101 dataset, and performs batch experiments with various configurations on one or eight GPUs.",
    "details": [
        {
            "comment": "This code snippet is part of a script for running the TimeSformer model benchmark in PaddleVideo. It sets up the environment, installs required dependencies, and copies necessary configuration files and data to ensure stable performance.",
            "location": "\"/media/root/Prima/works/PaddleVideo/docs/src/benchmark/TimeSformer/run_all.sh\":0-19",
            "content": "# \u63d0\u4f9b\u53ef\u7a33\u5b9a\u590d\u73b0\u6027\u80fd\u7684\u811a\u672c\uff0c\u9ed8\u8ba4\u5728\u6807\u51c6docker\u73af\u5883\u5185py37\u6267\u884c\uff1a paddlepaddle/paddle:latest-gpu-cuda10.2-cudnn7  paddle=2.1.2  py=37\n# \u6267\u884c\u76ee\u5f55\uff1a\u9700\u8bf4\u660e\nsed -i '/set\\ -xe/d' run_benchmark.sh\ncd ../../ # cd\u5230PaddleVideo\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\ngit checkout benchmark_dev\nlog_path=${LOG_PATH_INDEX_DIR:-$(pwd)}  #  benchmark\u7cfb\u7edf\u6307\u5b9a\u8be5\u53c2\u6570,\u4e0d\u9700\u8981\u8dd1profile\u65f6,log_path\u6307\u5411\u5b58speed\u7684\u76ee\u5f55\n# 1 \u5b89\u88c5\u8be5\u6a21\u578b\u9700\u8981\u7684\u4f9d\u8d56 (\u5982\u9700\u5f00\u542f\u4f18\u5316\u7b56\u7565\u8bf7\u6ce8\u660e)\npython -m pip install -r requirements.txt\n# 2 \u62f7\u8d1d\u8be5\u6a21\u578b\u9700\u8981\u6570\u636e\u3001\u9884\u8bad\u7ec3\u6a21\u578b\nunalias cp\ncp -f benchmark/TimeSformer/timesformer_ucf101_videos_benchmark_bs1.yaml configs/recognition/timesformer/\ncp -f benchmark/TimeSformer/timesformer_ucf101_videos_benchmark_bs1_mp.yaml configs/recognition/timesformer/\ncp -f benchmark/TimeSformer/timesformer_ucf101_videos_benchmark_bs14.yaml configs/recognition/timesformer/\ncp -f benchmark/TimeSformer/timesformer_ucf101_videos_benchmark_bs14_mp.yaml configs/recognition/timesformer/\nif [ ! -f \"data/ucf101/trainlist_benchmark_mp.txt\" ]; then\n    wget -P data/ucf101/ https://videotag.bj.bcebos.com/PaddleVideo-release2.2/trainlist_benchmark_mp.txt\nfi\nwget -P "
        },
        {
            "comment": "This script downloads and prepares the UCF101 dataset for the TimeSformer model in PaddleVideo. It checks if the user wants to download data or use local data, then proceeds accordingly. The script also sets up a loop to run batch experiments with different model modes (TimeSformer), floating point items (fp32, fp16), and batch sizes (1). The log name is based on the model mode, run mode (speed), batch size, and floating point item. It uses CUDA_VISIBLE_DEVICES=0 to specify the GPU for execution.",
            "location": "\"/media/root/Prima/works/PaddleVideo/docs/src/benchmark/TimeSformer/run_all.sh\":19-46",
            "content": "data/ https://paddle-imagenet-models-name.bj.bcebos.com/dygraph/ViT_base_patch16_224_pretrained.pdparams\nalias cp='cp -i'\ncd data/ucf101 # \u8fdb\u5165PaddleVideo/data/ucf101\nif [ $1 = \"down_data\" ];then\n    wget --no-check-certificate \"https://www.crcv.ucf.edu/data/UCF101/UCF101.rar\" # \u4e0b\u8f7d\u8bad\u7ec3\u6570\u636e\n    unrar x UCF101.rar # \u89e3\u538b\n    mv ./UCF-101 ./videos # \u91cd\u547d\u540d\u6587\u4ef6\u5939\u4e3a./videos\n    rm -rf ./UCF101.rar\nelse    # \u4f7f\u7528\u672c\u5730\u6570\u636e\n    rm -rf videos\n    ln -s ${data_path}/dygraph_data/TSM/ucf101/videos ./videos\nfi\ncd ../../ # \u8fd4\u56dePaddleVideo\n# 3 \u6279\u91cf\u8fd0\u884c\uff08\u5982\u4e0d\u65b9\u4fbf\u6279\u91cf\uff0c1\uff0c2\u9700\u653e\u5230\u5355\u4e2a\u6a21\u578b\u4e2d\uff09\nmodel_mode_list=(TimeSformer)\nfp_item_list=(fp32 fp16)\nbs_item_list=(1)    #  14\nfor model_mode in ${model_mode_list[@]}; do\n      for fp_item in ${fp_item_list[@]}; do\n          for bs_item in ${bs_item_list[@]}\n            do\n            run_mode=sp\n            log_name=video_${model_mode}_${run_mode}_bs${bs_item}_${fp_item}   # \u5982:clas_MobileNetv1_mp_bs32_fp32_8\n            echo \"index is speed, 1gpus, begin, ${log_name}\"\n            CUDA_VISIBLE_DEVICES=0 bash benchmark/${model_m"
        },
        {
            "comment": "The script iterates over different model modes, batch sizes, and floating-point types. It first runs a benchmark with one GPU and logs the results, then sleeps for 60 seconds. Next, it repeats the process but uses eight GPUs in parallel. The script aims to test various configurations and collect performance data.",
            "location": "\"/media/root/Prima/works/PaddleVideo/docs/src/benchmark/TimeSformer/run_all.sh\":46-56",
            "content": "ode}/run_benchmark.sh ${run_mode} ${bs_item} ${fp_item} ${model_mode} | tee ${log_path}/${log_name}_speed_1gpus 2>&1\n            sleep 60\n            run_mode=mp\n            log_name=video_${model_mode}_${run_mode}_bs${bs_item}_${fp_item}   # \u5982:clas_MobileNetv1_mp_bs32_fp32_8\n            echo \"index is speed, 8gpus, run_mode is multi_process, begin, ${log_name}\"\n            CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7 bash benchmark/${model_mode}/run_benchmark.sh ${run_mode} ${bs_item} ${fp_item} ${model_mode} | tee ${log_path}/${log_name}_speed_8gpus8p 2>&1\n            sleep 60\n            done\n      done\ndone"
        }
    ]
}